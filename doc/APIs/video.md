# Flask 视频流媒体 API 文档

## 概览
此 API 提供了在基于 Flask 的网络应用程序中上传、管理和流媒体播放视频的基本功能。

## 端点/Endpoints

1. **上传视频页面**
   - **URL**: `/upload_video`
   - **方法**: `GET`
   - **访问控制**: Root, Admin
   - **描述**: 渲染视频上传页面。

2. **上传视频**
   - **URL**: `/video_upload`
   - **方法**: `POST`
   - **访问控制**: Root, Admin
   - **描述**: 处理视频文件的上传，将其处理为 m3u8 格式，并将视频信息保存在数据库中。
   - **数据参数**: `{ file: [视频文件] }`
   - **成功响应**: `{ code: 0, msg: "上传视频成功" }`

3. **删除视频**
   - **URL**: `/delete_video/<int:video_id>`
   - **方法**: `POST`
   - **访问控制**: Root, Admin
   - **描述**: 从服务器删除视频文件及其关联的 m3u8 和 ts 文件，并从数据库中删除其记录。
   - **URL 参数**: `video_id=[整数]`
   - **成功响应**: `{ code: 0, msg: "视频删除成功" }`
   - **错误响应**: `{ code: 1, msg: "视频未找到" }`

4. **重命名视频**
   - **URL**: `/rename_video/<int:video_id>`
   - **方法**: `POST`
   - **访问控制**: Root, Admin
   - **描述**: 在数据库中重命名现有视频。
   - **URL 参数**: `video_id=[整数]`
   - **数据参数**: `{ newName: [字符串] }`
   - **成功响应**: `{ code: 0, msg: "视频重命名成功" }`
   - **错误响应**: `{ code: 1, msg: "视频未找到或新名称无效" }`

5. **管理视频**
   - **URL**: `/manage`
   - **方法**: `GET`
   - **描述**: 渲染视频管理页面，列出所有视频。

6. **播放视频**
   - **URL**: `/video_play`
   - **方法**: `GET`
   - **描述**: 为特定视频渲染视频播放页面。
   - **URL 参数**: `video_id=[整数]`

7. **搜索视频**
   - **URL**: `/search_videos`
   - **方法**: `GET`
   - **描述**: 按名称搜索视频。
   - **URL 参数**: `query=[字符串]`
   - **成功响应**: 符合搜索查询的视频列表。

## ORM模型

- **VideoORM**: 表示数据库中的视频记录。
  - `id`: 整数，主键，自增。
  - `name`: 字符串，视频名称。
  - `url`: 字符串，视频文件的 URL。
  - `m3u8_url`: 字符串，m3u8 文件的 URL。
  - `create_at`: 日期时间，上传视频的时间。
  - `is_public`: 布尔值，指示视频是否为公开。

## 注意事项

- API 限制具有特定角色（root, admin）的用户认证才能进行某些操作，生产环境中可调整为权限组，以便更好地管理用户。
- 视频处理包括将上传的视频转换为 m3u8 格式索引以及ts文件流，以进行流媒体播放。
- 部分实现了错误处理，用于文件删除错误和数据库记录未找到等场景。
- 未实现视频模糊搜索功能，但是可以通过数据库查询实现。

## 未来工作

- 为视频添加评分/分级
- 为视频添加分类
- 为视频添加描述